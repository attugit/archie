language: c++
sudo: required
services:
  - docker

env:
  - BUILDTYPE=debug
  - BUILDTYPE=release

before_install:
  - docker build -t attugit/testing -f ci/testing.docker .

script:
  - docker run --rm --volume="$PWD:/mnt/archie" --workdir=/mnt/archie attugit/testing /bin/bash -c "./waf distclean configure build_${BUILDTYPE} install_${BUILDTYPE} --testcmd=\"valgrind --error-exitcode=1 %s\" --prefix=/usr"
